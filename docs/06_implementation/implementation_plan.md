# 実装計画書

## 概要

本ドキュメントは、Cocktailpedia の実装タスクを定義する。
CCはこのドキュメントを参照してタスクごとに実装を進める。

---

## 関連ドキュメント

| ドキュメント | パス |
|-------------|------|
| 基本設計書 | docs/05_design/basic_design.md |
| 機能要件書 | docs/02_requirements/functional.md |
| 画面要件書 | docs/02_requirements/screens.md |
| 技術選定書 | docs/03_tech_stack/tech_stack.md |
| コーディング規約 | docs/04_guidelines/coding_standards.md |
| コンポーネント設計 | docs/04_guidelines/component_architecture.md |
| テスト戦略 | docs/04_guidelines/test_strategy.md |

---

## 実装規模の見積もり

### 画面一覧

| 分類 | 画面数 | 詳細 |
|------|--------|------|
| 公開画面 | 7 | トップ、詳細、ベース別一覧、お気に入り、サイト説明、404、検索モーダル |
| 管理画面 | 6 | ダッシュボード、カクテル一覧/登録編集、材料一覧/登録編集、サイト設定 |
| **合計** | **13** | |

### 機能一覧（Must/Should）

| 優先度 | 件数 | 機能 |
|--------|------|------|
| Must | 6 | F-001〜F-006 |
| Should | 4 | F-007, F-008, F-009, F-012, F-013 |
| Could | 2 | F-010, F-014 |

---

## タスク分割

### 方針

- **レイヤー単位**でタスクを分割
- CCが1セッションで完了できる範囲に収める
- 依存関係の順番でタスクを実行

### タスク一覧

| # | タスク名 | 概要 | 依存 |
|---|---------|------|------|
| 1 | 環境構築 | Next.js + Tailwind + shadcn/ui + Supabase設定 | - |
| 2 | 共通基盤 | 型定義、共通コンポーネント、レイアウト | 1 |
| 3 | データベース | Supabase: テーブル作成、RLS設定 | 1 |
| 4 | 公開画面（基本） | トップページ、詳細ページ、ベース別一覧 | 2, 3 |
| 5 | 公開画面（追加） | お気に入り、サイト説明、404、検索モーダル | 4 |
| 6 | 管理画面（カクテル） | カクテル一覧/登録/編集/削除、画像アップロード | 3, 2 |
| 7 | 管理画面（その他） | 材料管理、サイト設定、ダッシュボード | 6 |
| 8 | 結合・調整 | 全体動作確認、微調整 | 全タスク |

---

## タスク詳細

### タスク1: 環境構築

**目的**: 開発環境を構築し、基本的なプロジェクト設定を完了する

#### 達成すべきこと

- [x] Next.js 15 (App Router) プロジェクトを `src/` に作成
- [x] Tailwind CSS v4 の設定
- [x] shadcn/ui の初期設定（Button, Card 等の基本コンポーネント追加）
- [x] Supabase クライアントの設定
- [x] 環境変数の設定（`.env.local.example` 作成）
- [x] ESLint / Prettier の設定
- [x] 開発サーバーが起動し、トップページが表示されること

#### インストール先

> [!IMPORTANT]
> 開発フレームワークは **`src/` ディレクトリ** にインストールすること。
> プロジェクトルート直下には配置しない（ルートはドキュメント・設定ファイル用）。

#### 完了後の構成

```
project-root/
├── docs/            # ドキュメント
├── PROJECT.md       # プロジェクト管理
└── src/             # ← ここにNext.jsプロジェクト
    ├── app/
    ├── components/
    ├── package.json
    └── ...
```

#### 参照ドキュメント

- docs/03_tech_stack/tech_stack.md
- docs/04_guidelines/coding_standards.md

---

### タスク2: 共通基盤

**目的**: 型定義と共通コンポーネントを作成し、実装の基盤を整える

#### 達成すべきこと

- [ ] 型定義の作成
  - Cocktail, Ingredient, RecipeItem, SiteSetting
  - 検索フィルター用の型
  - 選択肢定義（base, technique, glass 等）
- [ ] 共通コンポーネントの作成
  - Header（ロゴ、ナビ、検索アイコン、お気に入りアイコン）
  - Footer（コピーライト、サイト説明リンク）
  - CocktailCard（画像、名前、ベース、お気に入りボタン）
  - ソートセレクト
- [ ] レイアウトの設定（app/layout.tsx）
  - ダークテーマの設定
  - Google Analytics 4 の導入
  - メタデータの設定

#### 参照ドキュメント

- docs/05_design/basic_design.md（1.5 選択肢定義）
- docs/02_requirements/screens.md（共通コンポーネント）
- docs/04_guidelines/component_architecture.md

---

### タスク3: データベース

**目的**: Supabaseにテーブルを作成し、初期データを投入できる状態にする

#### 達成すべきこと

- [ ] テーブル作成（migration SQL）
  - cocktails
  - ingredients
  - recipe_items
  - site_settings
- [ ] RLS (Row Level Security) ポリシーの設定
  - 公開画面: 全て読み取り可能
  - 管理操作: 認証不要（Basic認証はMiddlewareで実施）
- [ ] Supabase Storage バケット作成
  - `cocktail-images` バケット（公開読み取り可能）
- [ ] 初期データ投入用のシード（任意）

#### 参照ドキュメント

- docs/05_design/basic_design.md（1. データモデル設計）

---

### タスク4: 公開画面（基本）

**目的**: コア機能である一覧・詳細・検索を実装する

#### 達成すべきこと

- [ ] トップページ（S-001）
  - カクテル一覧表示（無限スクロール、60件ずつ）
  - ソート機能
  - 最近見たカクテル（localStorage）
- [ ] カクテル詳細ページ（S-002）
  - 全情報の表示
  - 閲覧カウント（Server Action）
  - 閲覧履歴記録（localStorage）
  - 関連カクテル表示
  - お気に入り登録/解除
- [ ] ベース別一覧（S-003）
  - `/filter/[base]` ルーティング
  - ベースでフィルタリング
- [ ] 検索モーダル（S-007）
  - 全検索条件の入力フォーム
  - AND検索の実装

#### 参照ドキュメント

- docs/02_requirements/functional.md（F-001〜F-004, F-012, F-013）
- docs/02_requirements/screens.md（S-001〜S-003, S-007）

---

### タスク5: 公開画面（追加）

**目的**: 補助的な公開画面を実装する

#### 達成すべきこと

- [ ] お気に入り一覧（S-004）
  - localStorageから取得
  - 検索・ソート機能
- [ ] サイト説明ページ（S-005）
  - site_settingsからコンテンツ取得
  - Markdown表示
- [ ] 404エラーページ（S-006）
  - エラーメッセージ
  - トップへ戻るリンク

#### 参照ドキュメント

- docs/02_requirements/functional.md（F-005, F-006, F-010）
- docs/02_requirements/screens.md（S-004〜S-006）

---

### タスク6: 管理画面（カクテル）

**目的**: カクテルのCRUD機能を実装する

#### 達成すべきこと

- [ ] Basic認証Middleware
  - `/admin/*` パスに適用
  - 環境変数から認証情報取得
- [ ] カクテル一覧画面（S-102）
  - テーブル形式で表示
  - 検索機能
  - 編集/削除リンク
- [ ] カクテル登録/編集画面（S-103）
  - フォーム入力
  - 画像アップロード（Supabase Storage）
  - バリデーション
  - 保存処理（Server Action）
  - 削除処理（確認ダイアログ付き）

#### 参照ドキュメント

- docs/02_requirements/functional.md（F-008）
- docs/02_requirements/screens.md（S-102, S-103）
- docs/05_design/basic_design.md（2. API設計 - 画像アップロード仕様）

---

### タスク7: 管理画面（その他）

**目的**: 材料管理、サイト設定、ダッシュボードを実装する

#### 達成すべきこと

- [ ] 材料一覧画面（S-104）
  - テーブル形式で表示
  - 編集/削除リンク
- [ ] 材料登録/編集画面（S-105）
  - フォーム入力
  - 使用中の材料削除時は警告
- [ ] サイト設定画面（S-106）
  - サイト説明文の編集（Markdown）
- [ ] 管理ダッシュボード（S-101）
  - 統計情報表示
  - カクテル数、材料数、総閲覧回数

#### 参照ドキュメント

- docs/02_requirements/functional.md（F-009, F-010, F-014）
- docs/02_requirements/screens.md（S-101, S-104〜S-106）

---

### タスク8: 結合・調整

**目的**: 全体を通して動作確認し、微調整を行う

#### 確認観点

- [ ] 画面遷移
  - 全画面を通して遷移できるか
- [ ] データフロー
  - 登録→表示→更新→削除が正しく動くか
- [ ] エラー処理
  - エラー時に適切な表示がされるか
- [ ] レスポンシブ
  - モバイル・PCで崩れないか
- [ ] パフォーマンス
  - 極端に遅いページがないか

---

## 優先度の調整

以下の機能は優先度 Could のため、タスク7の中で余裕があれば実装する。
なければスキップして将来対応とする。

- F-010: サイト設定管理
- F-014: 管理ダッシュボード

---

## 備考

- 作成日: 2026/01/22
- 作成者: AG
- ステータス: 施主承認済み

### 更新履歴

| 日付 | 内容 | 担当 |
|------|------|------|
| 2026/01/22 | 初版作成 | AG |
