---
description: プロジェクトの開発ルールを定めます。
---

# Ph4. ガイドライン生成フェーズ指示書

## フェーズ概要

| 項目 | 内容 |
|------|------|
| 目的 | 実装時のルールを定める（AG / CC / 施主の共通認識） |
| 担当 | AG |
| 成果物 | コーディング規約、テスト戦略、コンポーネントアーキテクチャ |
| 前フェーズ | Ph3. 技術選定 |
| 次フェーズ | Ph5. 設計 |

---

## ワークフロー

```
Step1: コーディング規約を決める
  ↓ 施主確認
Step2: テスト戦略を決める
  ↓ 施主確認
Step3: コンポーネントアーキテクチャを決める
  ↓ 施主確認
Step4: CCレビュー・施主承認
  ↓
完了 → Ph5へ
```

**ポイント**:
- 技術選定の結果を踏まえて決める
- 「決めすぎない」ことも大事（CCの裁量を残す）
- 個人開発なので、ガチガチにしすぎない

---

## Step1: コーディング規約

### 目的

命名規則やディレクトリ構成など、コードの書き方ルールを決める。

### 決めること

#### 1-1. 命名規則

以下の項目について、施主と確認する。
（特にこだわりがなければ、テンプレートのデフォルトでOK）

| 項目 | デフォルト | 確認内容 |
|------|-----------|---------|
| コンポーネントファイル | PascalCase | 変更したい？ |
| ディレクトリ | kebab-case | 変更したい？ |
| 変数・関数 | camelCase | 変更したい？ |
| 定数 | UPPER_SNAKE_CASE | 変更したい？ |

**質問例**:
- 命名規則にこだわりはある？
- 特になければ一般的なルール（テンプレート）で進めるよ

#### 1-2. ディレクトリ構成

技術選定で決めたフレームワークに合わせて、基本構成を確認する。

**質問例**:
- ディレクトリ構成はフレームワークの推奨に従う形でいい？
- 特に追加したいフォルダはある？

#### 1-3. プロジェクト固有のルール

上記以外に、このプロジェクトで決めておきたいルールがあるか確認。

**質問例**:
- コードの書き方で「これは守りたい」というルールはある？
- 逆に「これはやりたくない」というものはある？

### 成果物

`ph-4-guidelines-coding.tmp.md` を埋める。

### Step1 完了条件

- [ ] 命名規則が決まっている（デフォルト採用でもOK）
- [ ] ディレクトリ構成が決まっている
- [ ] **コーディング規約（coding_standards.md）が作成されている**
- [ ] 施主が「Step1はこれでOK」と言っている

**次のセッションへの引き継ぎ**:
Step1完了時点でコーディング規約を保存し、次セッション開始時に参照できるようにしておく。

---

## Step2: テスト戦略

### 目的

テストをどこまで書くか、方針を決める。
「何をテストするか」より「何をテストしないか」を決めることが重要。

### 決めること

#### 2-1. 基本スタンス

以下の選択肢を提示し、施主に選んでもらう。

| スタンス | 説明 | 向いているケース |
|---------|------|----------------|
| **積極的** | 主要な機能にはテストを書く | 長期運用、機能追加が多い |
| **選択的** | 複雑なロジックのみテストを書く | バランス重視 |
| **最小限** | 基本的にテストは書かず、目視確認 | 個人開発、プロトタイプ |
| **なし** | テストは書かない | 使い捨て、検証目的 |

**質問例**:
- テストはどのくらい書きたい？
- このプロジェクトの規模・目的だと「選択的」か「最小限」がおすすめだけど、どう思う？

#### 2-2. テストの種類

基本スタンスに応じて、採用するテストの種類を決める。

| 種類 | 説明 | 採用の目安 |
|------|------|-----------|
| 単体テスト | 関数・ロジック単位 | 選択的以上なら採用 |
| 結合テスト | コンポーネント間の連携 | 積極的なら検討 |
| E2Eテスト | ユーザー操作の再現 | 重要な導線があれば検討 |

**質問例**:
- 単体テストだけでいい？それともE2Eも入れたい？

#### 2-3. CCへの指示方針

テストを書くかどうか、CCにどう指示するかを決める。

| 方針 | 説明 |
|------|------|
| 都度指示 | 「この機能にはテストを書いて」と毎回指定 |
| CCにお任せ | 「必要に応じてテストも書いて」と委ねる |
| 書かない | 「テスト不要」と明示 |

### 成果物

`ph-4-guidelines-test.tmp.md` を埋める。

### Step2 完了条件

- [ ] 基本スタンスが決まっている
- [ ] 採用するテストの種類が決まっている
- [ ] CCへの指示方針が決まっている
- [ ] **テスト戦略（test_strategy.md）が作成されている**
- [ ] 施主が「Step2はこれでOK」と言っている

**次のセッションへの引き継ぎ**:
Step2完了時点でテスト戦略を保存し、次セッション開始時に参照できるようにしておく。

---

## Step3: コンポーネントアーキテクチャ

### 目的

コンポーネントをどう分類・配置するかのルールを決める。

### 決めること

#### 3-1. 採用パターン

以下の選択肢を提示し、施主に選んでもらう。

| パターン | 説明 | 向いているケース |
|---------|------|----------------|
| **Atomic Design** | 階層的に分類（Atoms→Molecules→Organisms→Templates→Pages） | 大規模、デザインシステム構築 |
| **Feature-based** | 機能ごとにまとめる | 中〜大規模、機能が独立している |
| **フラット** | 特にルールなし、シンプルに配置 | 小規模、プロトタイプ |

**質問例**:
- コンポーネントの整理方法にこだわりはある？
- このプロジェクトの規模だと「フラット」か「Feature-based」がおすすめだけど、どう思う？

#### 3-2. 採用理由

なぜそのパターンを選んだかを記録する。

#### 3-3. プロジェクト固有のルール

標準から変更・追加するルールがあれば決める。

### 成果物

`ph-4-guidelines-component.tmp.md` を埋める。

### Step3 完了条件

- [ ] 採用パターンが決まっている
- [ ] 採用理由が記載されている
- [ ] **コンポーネントアーキテクチャ（component_architecture.md）が作成されている**
- [ ] 施主が「Step3はこれでOK」と言っている

**次のセッションへの引き継ぎ**:
Step3完了時点でコンポーネントアーキテクチャを保存し、次セッション開始時に参照できるようにしておく。

---

## Step4: CCレビュー・施主承認

### CCレビュー依頼

全ガイドラインが揃ったら、CCにレビューを依頼する。

**レビュー依頼テンプレート**:
```
以下のガイドラインをレビューしてください。

対象:
- docs/04_guidelines/coding_standards.md
- docs/04_guidelines/test_strategy.md
- docs/04_guidelines/component_architecture.md

レビュー観点:
1. 実装時に迷いそうな曖昧な記述がないか
2. 技術選定（tech_stack.md）との矛盾がないか
3. 個人開発の規模に対して過剰なルールがないか
4. 抜け漏れ（一般的に決めておくべきだが記載がない項目）

問題があれば具体的に指摘してください。
問題がなければ「問題なし」と回答してください。
```

### 施主最終承認

CCレビューで問題がなければ（または問題を解消したら）、施主に最終確認。

### 完了条件

- [ ] CCレビュー完了、指摘対応済み
- [ ] 施主が「ガイドライン完了」と承認

---

## 完了条件（フェーズ全体）

以下のすべてを満たしたら、ガイドライン生成フェーズ完了として Ph5 へ進む。

- [ ] コーディング規約が作成されている
- [ ] テスト戦略が作成されている
- [ ] コンポーネントアーキテクチャが作成されている
- [ ] CCレビュー完了
- [ ] 施主が「ガイドライン完了」と承認

**次のセッションへの引き継ぎ**:
ガイドライン生成フェーズ完了時点で全ガイドラインを保存し、Ph5開始時に参照できるようにしておく。

---

## AGの姿勢

- **決めすぎない**：CCの裁量を残す。細かすぎるルールは運用されない
- **デフォルトを活用**：特にこだわりがなければ、テンプレートのデフォルトでOK
- **個人開発の前提**を忘れない：ガチガチのルールは不要
- **実行可能なルール**にする：守れないルールは意味がない

---

## 補足：Gitルールについて

Gitルールは CLAUDE.md に直接記載する方針のため、このフェーズでは扱わない。

CLAUDE.md に書く内容の例：
- ブランチ命名規則（例：`feature/task-XX-説明`）
- コミットメッセージのフォーマット
- マージ方針