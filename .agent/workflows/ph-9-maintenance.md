---
description: 運用と保守フェーズの指示書
---

# Ph9. 保守フェーズ指示書

## フェーズ概要

| 項目 | 内容 |
|------|------|
| 目的 | リリース後のサービスを継続的に運用・改善する |
| 担当 | 施主（判断・実行）、CC（実装サポート）、AG（要件整理サポート） |
| 成果物 | 保守運用ガイド、変更履歴 |
| 前フェーズ | Ph8. デプロイ |

**このフェーズの特徴**:
- 終わりのないフェーズ（サービス終了まで続く）
- バグ修正、機能追加、改善を継続的に行う
- 問題の規模に応じて、適切なフェーズに戻る

---

## 保守の種類

| 種類 | 内容 | 頻度 |
|------|------|------|
| バグ修正 | 発見されたバグを修正 | 随時 |
| 機能追加 | 新しい機能を追加 | 計画的に |
| 改善 | 既存機能の使い勝手向上 | 随時〜計画的に |
| 依存関係更新 | ライブラリ、フレームワークの更新 | 定期的に |
| セキュリティ対応 | 脆弱性への対応 | 随時（緊急） |

---

## バグ発生時のフロー

### フロー概要

```
バグ発見
  ↓
影響度・緊急度を判定
  ↓
対応方針を決定
  ↓
修正実装（CC）
  ↓
テスト
  ↓
デプロイ
  ↓
完了報告
```

### 影響度・緊急度の判定

| 緊急度 | 定義 | 対応目安 |
|--------|------|---------|
| Critical | サービス全体が停止、データ破損 | 即時対応（数時間以内） |
| High | 主要機能が使えない | 当日〜翌日 |
| Medium | 一部機能に問題あり、代替手段あり | 1週間以内 |
| Low | 軽微な問題、見た目の問題 | 余裕があるとき |

### 対応フロー詳細

#### Critical / High の場合

```
1. 状況を把握（再現手順、影響範囲）
2. 一時対応が可能か検討（メンテナンスモード、ロールバック）
3. CCに修正依頼
4. 修正→テスト→デプロイ
5. 本番確認
6. 原因と対策をドキュメント化
```

**CCへの緊急修正依頼**:
```
## 緊急バグ修正依頼

### 緊急度
Critical / High

### バグ内容
〇〇画面で△△すると□□になる

### 影響範囲
- 全ユーザーに影響 / 一部ユーザーに影響
- データへの影響：あり / なし

### 再現手順
1. 
2. 
3. 

### 期待動作
●●が表示される

### 実際の動作
××になる

### 補足
- エラーログ：（あれば）
- スクリーンショット：（あれば）
```

#### Medium / Low の場合

```
1. バグ管理リストに記録
2. 他の作業と優先度を比較
3. 適切なタイミングで対応
4. 修正→テスト→デプロイ
```

### バグ管理

バグは保守運用ガイド（`ph-9-maintenance.tmp.md`）の「バグ管理」セクションで管理する。

---

## 機能追加時のフロー

### 規模による分類

| 規模 | 例 | 戻るフェーズ |
|------|-----|-------------|
| 小規模 | 文言修正、スタイル調整、ボタン追加 | Ph6（実装）から |
| 中規模 | 新しい画面追加、既存機能の拡張 | Ph2（要件定義）から |
| 大規模 | 新機能群の追加、アーキテクチャ変更 | Ph1（企画）から |

### フロー詳細

#### 小規模な変更

```
施主: 変更内容を決定
  ↓
CC: 実装
  ↓
施主: レビュー・テスト
  ↓
デプロイ
```

**CCへの指示例**:
```
## 小規模変更依頼

### 変更内容
〇〇画面の△△ボタンのテキストを「□□」に変更

### 達成すべきこと
- ボタンのテキストが「□□」になっている
- 他の画面に影響がないこと

### 参照
- 該当ファイル：src/components/XxxButton.tsx
```

#### 中規模な変更

```
施主: やりたいことを整理
  ↓
AG（または施主）: 要件を明確化
  - 機能要件に追記
  - 画面要件に追記（必要に応じて）
  ↓
施主: 要件を確認
  ↓
CC: 設計確認（既存設計との整合性）
  ↓
CC: 実装
  ↓
テスト
  ↓
デプロイ
```

**要件追加の例**:
```
## 機能追加要件

### 追加機能
F-010: お気に入り機能

### 概要
ユーザーが投稿をお気に入りに登録できる

### 詳細
（functional.md の形式に従って記載）

### 関連する画面変更
- S-003（投稿詳細）にお気に入りボタンを追加
- S-010（お気に入り一覧）を新規追加
```

#### 大規模な変更

```
施主: やりたいことを整理
  ↓
AG: 企画からヒアリング
  - 目的、ゴール、影響範囲を明確化
  ↓
AG: 要件定義
  ↓
CC: 技術的な影響を確認
  ↓
AG: 必要に応じて設計更新
  ↓
CC: 実装
  ↓
テスト
  ↓
デプロイ
```

---

## 改善（リファクタリング・UX改善）

### いつやるか

- バグ修正や機能追加のついでに
- 技術的負債が溜まってきたと感じたとき
- ユーザーから使いにくいというフィードバックがあったとき

### 改善の優先度

| 優先度 | 例 |
|--------|-----|
| 高 | パフォーマンス問題、セキュリティ問題 |
| 中 | コードの可読性向上、重複コードの整理 |
| 低 | 命名の統一、コメントの追加 |

### CCへの改善依頼

```
## リファクタリング依頼

### 対象
src/components/XxxForm.tsx

### 改善内容
- 長すぎる関数を分割
- 重複したバリデーションロジックを共通化

### 守るべきこと
- 動作が変わらないこと
- 既存のテストがパスすること
```

---

## 依存関係の更新

### なぜ必要か

- セキュリティ脆弱性への対応
- バグ修正、パフォーマンス改善
- 新機能の利用

### 更新の頻度

| 種類 | 頻度 | 例 |
|------|------|-----|
| セキュリティパッチ | 随時（緊急） | 脆弱性が発見されたとき |
| マイナーアップデート | 月1回程度 | 機能追加、バグ修正 |
| メジャーアップデート | 計画的に | 大きな変更、破壊的変更あり |

### 更新手順

```
1. 現状の確認
   npm outdated

2. 更新内容の確認
   - CHANGELOGを読む
   - 破壊的変更（Breaking Changes）がないか確認

3. 更新実行
   npm update（マイナー）
   npm install xxx@latest（メジャー）

4. ビルド・テスト
   npm run build
   npm run test

5. 動作確認
   npm run dev で動作確認

6. デプロイ
```

**CCへの依頼**:
```
依存パッケージを更新してください。

対象：
- next: 14.0.0 → 14.1.0（マイナーアップデート）

手順：
1. npm install next@14.1.0
2. ビルドが通ることを確認
3. 動作確認
4. 問題なければ報告
```

---

## セキュリティ対応

### 脆弱性の検知

```bash
# npm の脆弱性チェック
npm audit

# 自動修正（可能な場合）
npm audit fix
```

### 対応フロー

```
脆弱性を検知
  ↓
影響度を確認（Critical / High / Medium / Low）
  ↓
Critical / High → 即時対応
Medium / Low → 計画的に対応
  ↓
パッケージ更新または回避策
  ↓
テスト
  ↓
デプロイ
```

---

## ドキュメント更新のルール

### いつ更新するか

| 変更の種類 | 更新するドキュメント |
|-----------|-------------------|
| 機能追加 | 要件定義書（functional.md）、必要に応じて他のドキュメント |
| 画面追加 | 画面要件書（screens.md） |
| API追加・変更 | 基本設計書（basic_design.md） |
| 技術スタック変更 | 技術選定書（tech_stack.md） |
| 環境変数追加 | デプロイ手順書（deploy_guide.md） |

### 更新のタイミング

- **原則**: 変更をデプロイしたら、ドキュメントも更新
- **例外**: 緊急対応時は後から更新でもOK（ただし忘れないこと）

### 更新履歴の記録

各ドキュメントの「更新履歴」セクションに記録する。

```
| 日付 | 内容 | 担当 |
|------|------|------|
| YYYY/MM/DD | お気に入り機能を追加 | 施主 |
```

---

## 定期メンテナンス

### 推奨する定期作業

| 作業 | 頻度 | 内容 |
|------|------|------|
| 依存関係の確認 | 月1回 | `npm outdated` で古いパッケージを確認 |
| セキュリティチェック | 月1回 | `npm audit` で脆弱性を確認 |
| バックアップ確認 | 月1回 | DBバックアップが正常に動作しているか確認 |
| アクセス解析確認 | 月1回 | アクセス状況、エラー状況を確認 |
| エラー監視確認 | 週1回 | Sentry等でエラーを確認 |

---

## サービス終了時

### 終了判断

- ユーザーがいなくなった
- 維持コストが見合わない
- 別サービスに移行する

### 終了手順

```
1. ユーザーへの告知（終了の1ヶ月前以上）
2. データエクスポート機能の提供（必要に応じて）
3. 新規登録の停止
4. サービス停止
5. データの削除（個人情報の適切な処理）
6. ドメイン・ホスティングの解約
```

---

## 補足：個人開発での保守の現実

### 完璧を目指さない

- 全てのバグを即座に直す必要はない
- ユーザーに大きな影響がなければ、後回しでもOK
- 「直さない」という判断も立派な判断

### モチベーション維持

- 大きな変更は小さく分割して達成感を得る
- 定期的にアクセス解析を見て、使われていることを実感する
- 時には放置して休む（個人開発なら許される）

### 最低限やること

| 項目 | 頻度 | 内容 |
|------|------|------|
| エラー確認 | 週1回 | 致命的なエラーが出ていないか |
| セキュリティ | 月1回 | 脆弱性のあるパッケージがないか |
| コスト確認 | 月1回 | 想定外の請求が来ていないか |