---
description: Ph1-5までの成果物を元に、実装に向けた実装計画書を作成します。
---

# Ph6. 実装フェーズ指示書

## フェーズ概要

| 項目 | 内容 |
|------|------|
| 目的 | 設計に基づいてコードを実装する |
| 担当 | AG（実装計画）、CC（実装）、施主（レビュー・判断・橋渡し） |
| 成果物 | 実装計画書（implementation_plan.md）、ソースコード |
| 前フェーズ | Ph5. 設計 |
| 次フェーズ | Ph7. テスト |

**このフェーズの特徴**:
- **実装計画はAGと施主で作成**する（AGが要件・設計を踏まえてタスク分割を提案）
- **実装作業はCCが担当**する（施主がCCに作業依頼を渡す）
- **CCからの相談・問題報告は施主がAGに持ち帰る**（AGが対応方針を判断）

**役割分担**:
| 役割 | 担当 | このフェーズでやること |
|------|------|---------------------|
| 建築家 | AG | 実装計画の作成、問題発生時の相談対応 |
| 職人 | CC | 実装作業、技術的な報告 |
| 施主 | 人間 | 最終判断、AG⇔CCの橋渡し、レビュー |

---

## ワークフロー

```
Step1: 実装計画を立てる【AG + 施主】
  - AGが要件・設計を確認し、タスク分割を提案
  - 施主と議論しながら実装計画を確定
  ↓
Step2: タスクごとに実装【CC + 施主】
  - 施主がCCに作業依頼
  - CCが実装 → 施主レビュー → マージ
  - 問題があれば施主がAGに相談
  ↓
Step3: 結合・調整【CC + 施主 + AG】
  - 全体を通して動作確認
  - 問題があればAGと相談して対応
  ↓
完了 → Ph7へ
```

---

## Step1: 実装計画を立てる【AG + 施主】

### 目的

要件・設計を確認し、どの順番で何を実装するかを決める。
**AGが主導**し、施主と議論しながら計画を確定する。

### 1-1. AGによるドキュメント確認

AGは以下のドキュメントを確認し、実装の全体像を把握する。

| ドキュメント | 確認観点 |
|-------------|---------|
| 基本設計書 | DB設計、API設計の実装ボリューム |
| 要件定義書 | 機能の優先度、依存関係 |
| 画面要件書 | 画面数、複雑さ |
| ガイドライン | コーディング規約、テスト方針 |
| 技術選定書 | 使用技術の確認 |

### 1-1-1. 環境構築タスクの設計（必須）

**最初のタスクは必ず「環境構築」とする。**

環境構築タスクの作業指示書には、以下を**必ず**明記すること：

> [!IMPORTANT]
> 開発フレームワーク（Next.js等）は **`src/` ディレクトリ** にインストールすること。
> プロジェクトルート直下には配置しない（ルートはドキュメント・設定ファイル用）。

**作業指示書の例**:
```
## 環境構築

### インストール先
`src/` ディレクトリに Next.js プロジェクトを作成する。

### 手順
1. `mkdir src && cd src`
2. `npx create-next-app@latest .`（現在のディレクトリに作成）

### 完了後の構成
project-root/
├── docs/            # ドキュメント
├── PROJECT.md       # プロジェクト管理
└── src/             # ← ここにNext.jsプロジェクト
    ├── app/
    ├── package.json
    └── ...
```

**参照**: `TAKUMI.md` の「ディレクトリ構成」セクション

---

### 1-2. AGによるタスク分割提案

AGは要件・設計を踏まえて、タスク分割を提案する。

**タスク分割の方針**:
- 粒度は「レイヤー単位」で切る（機能単位だと依存関係が複雑になる）
- CCが1セッションで完了できる範囲
- 成果物として独立してレビュー可能な範囲
- 「ここまでできたら動作確認できる」という単位

**推奨するタスク分割**:

```
タスク1: 共通基盤
  - 型定義
  - 共通コンポーネント（ヘッダー、フッター等）
  - DB設計の実装（マイグレーション）
  
タスク2: バックエンド
  - API実装一式
  - サーバーサイドロジック
  
タスク3: フロントエンド
  - 画面実装一式
  - クライアントサイドロジック
  
タスク4: 結合・調整
  - 全体結合
  - 動作確認・微調整
```

**AGの提案例**:
```
要件と設計を確認したよ。タスク分割はこんな感じでどうかな？

【タスク1: 共通基盤】
- 型定義（User, Post, Comment）
- 共通コンポーネント（Header, Footer, Button, Card）
- Supabaseのテーブル作成

【タスク2: バックエンド】
- Server Actions実装
- 認証処理

【タスク3: フロントエンド】
- 画面実装（5画面）
  - トップページ
  - 一覧ページ
  - 詳細ページ
  - 作成ページ
  - 設定ページ

【タスク4: 結合・調整】
- 全体の動作確認
- 微調整

タスク3が重そうなら、画面ごとに分けてもいいかも。どう思う？
```

### 1-3. 施主との議論・確定

施主はAGの提案を確認し、議論して確定する。

**施主が確認すること**:
- タスクの粒度は適切か（大きすぎ/小さすぎないか）
- 優先順位は正しいか
- 不明点や懸念点はないか

**議論のポイント**:
- 「タスク3が大きすぎる」→ 画面ごとに分割
- 「認証は後回しにしたい」→ タスク順序の入れ替え
- 「この機能は後回しでいい」→ タスクから除外（後のフェーズで対応）

### 1-4. 実装計画書の作成

タスク分割が確定したら、AGが実装計画書（`implementation_plan.md`）を作成する。

### Step1 完了条件

- [ ] AGがドキュメントを確認している
- [ ] タスク分割が施主と合意されている
- [ ] **実装計画書（task-n-implementation_plan.md）が作成されている**
- [ ] 施主が「この計画で進めよう」と承認

---

## Step2: タスクごとに実装【CC + 施主 + AG相談】

### 全体フロー

```
施主: 実装計画書をCCに渡し、タスクの作業依頼
  ↓
CC: ドキュメントを読み、質問があれば報告
  ↓
施主: 自分で判断できる → 回答
      判断に迷う → AGに相談 → 回答
  ↓
CC: 実装を進める
  ↓
CC: 完了報告 or 問題報告
  ↓
【完了報告の場合】
施主: レビュー → 問題なし → マージ → 次のタスクへ
            → 問題あり → フィードバック → 修正

【問題報告の場合】（画像依頼、技術的問題、要件の曖昧さ等）
施主: AGに持ち帰り相談
  ↓
AG: 対応方針を提案
  ↓
施主: 判断 → CCに指示
```

### CCへの最初の作業依頼

施主がCCに実装計画書を渡し、最初のタスクを依頼する。

**作業依頼テンプレート**:
```
以下のドキュメントを読んで、プロジェクトの全体像を把握してください。

【必ず読むもの】
- docs/06_implementation/task-XX-implementation_plan.md（実装計画）
- docs/05_design/basic_design.md（基本設計）
- docs/02_requirements/（要件定義）
- docs/04_guidelines/（ガイドライン）

【参考】
- docs/03_tech_stack/tech_stack.md（技術選定）
- docs/01_planning/project_overview.md（企画）

読み終わったら、最初のタスク（タスク1: 共通基盤）を開始してください。
質問や確認事項があれば、実装前に報告してください。
```

### ブランチ運用

CCは作業開始前に必ず作業用ブランチを作成する。

**フロー**:
```
1. 未コミットの変更がないか確認（あれば先にコミット or 施主に確認）
2. 作業用ブランチを作成
   命名規則：feature/task-XX-簡潔な説明
   例：feature/task-01-common-components
3. ブランチ上で実装
4. 完了後、施主に報告
5. 施主がレビュー → 問題なければmainにマージ
```

### CCへの実装指示

**指示の原則**: 「手順ベース」ではなく「ゴール＋制約ベース」で渡す

**手順ベース（NG）**:
```
1. まずsrc/components/Button.tsxを作成してください
2. 次にsrc/components/Header.tsxを作成してください
3. Header.tsxでButton.tsxをimportしてください
...
```

**ゴール＋制約ベース（OK）**:
```
## 作業開始前チェック
- [ ] 未コミットの変更がないことを確認（あれば先にコミット）
- [ ] 作業用ブランチを作成：`git checkout -b feature/task-01-common-components`

## 実装範囲
共通基盤（型定義、共通コンポーネント）

## 達成すべきこと
- 型定義（User, Post等）が完成している
- 共通コンポーネント（Header, Footer, Button等）が完成している
- Storybookで各コンポーネントが確認できる（Storybook採用時）

## 守るべき制約
- docs/04_guidelines/coding_standards.md に従う
- docs/04_guidelines/component_architecture.md に従う
- docs/05_design/basic_design.md のデータモデルに従う

## 参照ドキュメント
- 要件定義：docs/02_requirements/
- 基本設計：docs/05_design/basic_design.md

## 判断に迷ったら
- 自分で判断せず、選択肢を提示して施主に確認

## 作業完了後チェック
- [ ] 全ての変更をコミット
- [ ] 施主に完了報告
```

### CCからの報告パターンと対応

#### パターン1: 完了報告

```
## 完了報告

### 作成したもの
- src/components/Header/Header.tsx
- src/components/Footer/Footer.tsx
- src/types/user.ts
- ...

### 動作確認方法
1. `npm run dev` でローカルサーバー起動
2. http://localhost:3000 にアクセス
3. ヘッダー・フッターが表示されることを確認

### 備考
- 〇〇については△△の方針で実装しました
- □□の部分は次のタスクで対応予定です
```

**施主の対応**: レビューして問題なければマージ、次のタスクへ

#### パターン2: 質問・確認

```
実装前に確認させてください。

〇〇の部分について、要件定義には△△と書いてありますが、
□□と解釈して進めてよいですか？
```

**施主の対応**:
- 自分で判断できる → 回答
- 判断に迷う → **AGに相談してから回答**

#### パターン3: 画像アセット依頼

```
## 画像アセット依頼

以下の画像が必要です。

1. ヒーロー画像
   - 用途：トップページのメインビジュアル
   - イメージ：
     - 明るい、ポジティブな印象。
     - 公園のような緑が多い場所で老夫婦が空を見上げて微笑んでいる。
     - 背景には軽いブラーをかける。
     - 老夫婦は画面左側に位置する。
   - サイズ：1920x1080（16:9）
   - 出力先：./src/public/images/hero.png
```

**施主の対応**: **AGに持ち帰り、画像生成を依頼**（後述の「画像アセット依頼フロー」参照）

#### パターン4: 技術的問題

```
〇〇の実装が技術的に難しいです。

問題点：△△が□□のため、要件通りに実装できません。

代替案：
A. ○○の方法で近い動作を実現する
B. 要件を変更し、△△にする
```

**施主の対応**: **AGに持ち帰り相談 → 対応方針を決定 → CCに指示**

#### パターン5: 要件の曖昧さ発覚

```
〇〇の仕様が不明確です。

要件定義には「△△」とありますが、以下のどちらでしょうか？
A. □□として動作する
B. ●●として動作する
```

**施主の対応**: **AGに持ち帰り相談 → 要件を明確化 → CCに回答**
（必要に応じて要件定義書も更新）

### 施主のレビュー観点

| 観点 | 確認内容 |
|------|---------|
| 動作 | 期待通りに動くか |
| 要件充足 | 要件定義を満たしているか |
| コード品質 | ガイドラインに従っているか（軽く確認） |
| 不明点 | 意図がわからない実装がないか |

**レビューで問題が見つかった場合**:
```
## レビューフィードバック

### 修正してほしい点
- 〇〇が要件と違う（要件：△△、実装：□□）
- 〇〇の動作がおかしい（再現手順：...）

### 確認したい点
- 〇〇はなぜこの実装にした？
```

---

## 画像アセットの依頼フロー

CCが「画像が必要」と報告した場合、以下のフローで対応する。

**前提**: CCは画像を生成できない。画像生成はAG（Nano Banana等）が担当する。

**フロー**:
```
CC: 「ここに〇〇な画像が必要です」と施主に報告
  ↓
施主: AGに相談
  「CCからこんな画像依頼が来たんだけど」
  ↓
AG: 画像の仕様を確定
  - 用途、イメージ、サイズを明確化
  - 必要に応じてCCに追加ヒアリング
  ↓
AG: 画像を生成（Nano Banana等）
  ↓
施主: 画像をCCに渡す（パス指定 or ファイルアップロード）
  ↓
CC: 画像を配置して実装継続
```

**AGへの画像依頼例**:
```
CCからこんな画像依頼が来たよ。

【CCからの依頼内容】
1. ヒーロー画像
   - 用途：トップページのメインビジュアル
   - イメージ：明るい、ポジティブな印象
   - サイズ：1920x1080（16:9）

作成をお願いできる？
```

**AGの対応**:
- 仕様が曖昧な場合は施主に確認
- 画像を生成して施主に渡す
- 施主がCCにファイルを渡す

---

## 問題発生時のAGへの相談

CCから技術的問題や要件の曖昧さが報告された場合、施主はAGに相談する。

### 相談が必要なケース

| ケース | AGへの相談内容 |
|--------|---------------|
| 技術的に実現困難 | 要件の変更が必要か、代替案でOKか |
| 要件が曖昧 | 要件を明確化、必要なら要件定義書を更新 |
| 設計と合わない | 設計の変更が必要か検討 |
| 想定外のケース | 仕様としてどうあるべきか決定 |

### 相談のテンプレート

```
CCからこんな報告が来たんだけど、どう対応すればいい？

【CCからの報告】
（CCの報告内容をそのまま貼り付け）

【私の認識】
（自分なりの理解、判断があれば）
```

### AGの対応例

**技術的問題の場合**:
```
なるほど、〇〇が技術的に難しいんだね。

CCが提案している代替案Aで問題ないと思うよ。
要件の「△△」は「□□」に変更することになるけど、
ユーザー体験としては大きな差はないはず。

これでOKなら、CCに「代替案Aで進めて」と伝えて。
要件定義書のF-005も更新しておこうか？
```

**要件の曖昧さの場合**:
```
確かにここは曖昧だったね。

元の意図としては「●●」だったから、
CCの選択肢でいうと「A」が正解。

要件定義書にも追記しておくね。
（機能要件F-003の備考に追記）
```

---

## Step3: 結合・調整【CC + 施主 + AG】

### 目的

全タスクの実装が完了したら、全体を通して動作確認し、微調整を行う。

### 確認観点

| 観点 | 確認内容 |
|------|---------|
| 画面遷移 | 全画面を通して遷移できるか |
| データフロー | 登録→表示→更新→削除が正しく動くか |
| エラー処理 | エラー時に適切な表示がされるか |
| レスポンシブ | モバイル・PCで崩れないか |
| パフォーマンス | 極端に遅いページがないか |

### 問題発見時の対応

| 問題の種類 | 対応フロー |
|-----------|-----------|
| 軽微な問題（typo、微調整） | CCが修正→施主に事後報告 |
| 実装の問題（バグ、動作不良） | CCが修正→施主確認 |
| 設計の問題（仕様の根本的な誤り） | **施主がAGに相談→再設計を検討** |
| 要件の問題（そもそも要件が曖昧） | **施主がAGに相談→要件定義に差し戻し** |

---

## 完了条件（フェーズ全体）

以下のすべてを満たしたら、実装フェーズ完了として Ph7 へ進む。

- [ ] 実装計画書が作成されている（AGと施主で作成）
- [ ] 全タスクの実装が完了している
- [ ] 全タスクがmainにマージされている
- [ ] 結合テストで問題がない（または解消済み）
- [ ] 施主が「実装完了」と承認

---

## よくあるトラブルと対応

### トラブル1: CCが途中で止まる

**症状**: CCの返答が途中で切れる、実装が中途半端

**対応**:
- 「続きを」と指示して継続させる
- タスクを細かく分割して、1回で完了できる範囲に収める
- **タスク分割が大きすぎた場合はAGに相談して再分割**

### トラブル2: CCが勝手に判断して進める

**症状**: 仕様と違う実装をしている

**対応**:
- 「判断に迷ったら確認して」と明示
- 完了報告時に「何をどう判断したか」を報告させる

### トラブル3: 要件の抜け漏れが発覚

**症状**: 実装中に「これどうするんだっけ」が発生

**対応**:
- 軽微なら施主がその場で判断
- **重要ならAGに相談→要件定義に差し戻し（Ph2に戻る）**

### トラブル4: 技術的に実現困難

**症状**: CCが「これは難しい」と報告

**対応**:
- CCに代替案を提案させる
- **施主がAGに相談→代替案採用 or 要件変更を判断**

---

## 補足：各役割の心構え

### 施主の心構え

- **完璧を求めない**: 個人開発では「動く」が最優先。細かい見た目は後から調整
- **CCを信頼する**: 「どう作るか」はCCに任せる。口出ししすぎると効率が落ちる
- **早めに確認する**: タスクが終わるたびにレビュー。溜め込むと手戻りが大きくなる
- **判断は素早く**: CCが待っている時間が長いとプロジェクトが停滞する
- **迷ったらAGに相談**: 一人で抱え込まない

### AGの心構え

- **施主からの相談を待つ**: このフェーズでは施主経由でCCの状況を把握
- **素早くレスポンス**: 施主が相談してきたら、できるだけ早く対応方針を示す
- **要件・設計の番人**: CCの報告を聞いて、要件や設計との整合性を確認
- **ドキュメント更新**: 仕様が変わったら、対応するドキュメントも更新