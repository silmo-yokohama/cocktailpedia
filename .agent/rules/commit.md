---
trigger: manual
---

# コミット

ファイル差分を確認し、適切なコミットメッセージを生成してコミットを実行する。

---

## 📝 コミットメッセージ規約

> 詳細は [docs/guidelines/git.md](../../docs/guidelines/git.md) を参照

```
<type>(<scope>): <subject>

<body>

<footer>
```

**type一覧:**

| type | 用途 |
|------|------|
| `feat` | 新機能 |
| `fix` | バグ修正 |
| `docs` | ドキュメント |
| `style` | フォーマット（機能に影響なし） |
| `refactor` | リファクタリング |
| `test` | テスト |
| `chore` | ビルド、ツール等 |

---

## ワークフロー手順

### Step 1: 現在の状態を確認

```bash
git status
```

- ステージング済みファイルがあるか確認
- 変更ファイルの一覧を把握

---

### Step 2: コミット対象の決定

**自動判断ルール：**
- ステージング済みファイルがある → それを対象
- ステージング済みがない → 全変更を対象

> ユーザーから特別な指示がある場合（特定ファイルのみ、特定拡張子のみ等）はそれに従う

---

### Step 3: 差分の取得

一時ファイルに差分を出力する（大きな差分でも確実に読み取るため）。

```bash
mkdir -p ./.tmp
```

**ステージング済みファイルがある場合：**
```bash
git diff --cached > ./.tmp/pr.tmp.txt
```

**全変更を対象にする場合：**
```bash
git diff HEAD > ./.tmp/pr.tmp.txt
git status --porcelain >> ./.tmp/pr.tmp.txt
```

---

### Step 4: 差分を分析してコミットメッセージを生成

`./.tmp/pr.tmp.txt` の内容を読み込み、コミットメッセージを生成する。

**生成ルール:**
- 300文字以内
- 箇条書きOK
- type は変更内容から適切なものを選択
- scope は影響範囲（省略可）
- subject は変更の要約（50文字以内推奨）
- body は変更の詳細
- footer は Breaking Changes や Issue 番号があれば記載

**例:**
```
feat(recipe): レシピ詳細画面に材料一覧を追加

- 材料コンポーネントを新規作成
- APIからの材料データ取得処理を実装
- 単位変換ロジックを追加

Refs: COCKTAIL-123
```

---

### Step 5: ユーザー確認 → コミット実行

生成したコミットメッセージと対象ファイルをユーザーに提示し、確認を得る。

**提示内容：**
- 対象ファイル一覧
- 生成したコミットメッセージ

> ⚠️ **必ずユーザーの承認を得てからコミットを実行すること**

```bash
git commit -m "<生成したコミットメッセージ>"
```

---

### Step 6: 一時ファイルの削除

// turbo
```bash
rm -f ./.tmp/pr.tmp.txt
```

---

## 補足

- 差分が大きすぎる場合は、ファイルごとの変更概要を先に確認
- 複数の type にまたがる変更がある場合は、コミット分割を提案
- リモートへのプッシュは別途ユーザーの指示があった場合のみ実行